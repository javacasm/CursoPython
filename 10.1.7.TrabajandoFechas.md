## Midiendo tiempos

El módulo *[time](https://docs.python.org/3/library/time.html)* está pensado para medir tiempos. 

```python
import time

print(time.time()) # segundos desde 1/1/1970

print(time.localtime()) # estructura con los datos de fecha y hora 

print(time.strftime('%Y-%m-%d_%H:%M:%S',time.localtime())
```
* *time()*: Nos da un número decimal donde la parte entera son los segundos desde el 1 de enero de 1970 y la decimal la fracción de segundo.

* *localtime()* Nos da una estructura con la fecha y hora descompuesta

* *strftime(formato)*: nos devuelve una cadena con el dato de fecha y hora con el formato que le indicamos

* *sleep(segundos)*: detiene la ejecución del programa durante los *segundos* indicados. Este valor puede ser decimal.

También podemos usar *time()* para ver el tiempo que ha pasado entre dos momentos:

```python
>>> inicio = time.time()
>>> final = time.time()
>>> print(f'Han pasado {final-inicio} segundos')
Han pasado 8.950223922729492 segundos
```

## Operando con fechas con datetime

El módulo [datetime](https://docs.python.org/3/library/datetime.html) está pensado para operar con fechas.

* *datetime(año,mes,dia, hora, minuto, segundo)* crea un objeto con fecha (podemos omitir los que valores de hora, minuto y segundo).
* datetime.year o datetime.moth, ... nos da los valores esperados.
* *datetime.now()* nos da la fecha actual
* *datetime.strftime(formato)* convierte la fecha a una cadena con el formato indicado:
```python
>>> from datetime import datetime
>>> datetime.now().strftime('%Y-%m-%d_%H:%M:%S')
'2021-03-25_20:52:38'
```

* Podemos restar fechas, obteniendo una estructura *timedelta* de resultado, de donde podemos extraer los días con *days*, los segundos con *seconds* y los microsegundos con *microseconds*.

```python
>>> from datetime import datetime
>>> nacimiento = datetime(1970,25,12)
>>> hoy = datetime.now()
>>> print(f'han pasado {hoy - nacimiento}')
han pasado 18353 days, 20:32:50.215371
```

* Para obtener el día actual podemos usar *today()*

```python
from datetime import date
hoy = date.today()
print(hoy)
# para formatearlo a Mes día, año
print(hoy.strftime('%B %d, %Y'))

# para saber el día de la semana
print(hoy.weekday())
```
Vemos que nos muestra el número de día de la semana.

Vamos ahora a mostar los nombres de los días de la semana o de los meses, para lo que usaremos el módulo **calendar**, que dispone de varias listas con nombres:

* **month_name** con los nombres de los meses
* **month_abbr** con las abreviaturas de los nombres de los meses
* **day_name** con los nombres de los días
* **day_abbr** con las abreviaturas de los nombres de los días

La lista de los meses tiene un elemento vacío en la primera posición (posición 0) para que se correspondan los nombres con los números habituales (enero - 1, ....), con lo que podemos sacar una lista de los nombres de los meses con: 

```python
>>> import calendar
>>> calendar.month_name[1:]
['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
```

O la de los días de la semana con:

```python
>>> import calendar
>>> calendar.day_name[:]
['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']
```
También include constantes de los días de la semana y algunos meses (no sé porqué on están todos...) que corresponde con su número, por ejemplo *calendar.February* vale *2* o *calendar.TUESDAY* vale *1* y *calendar.MONDAY* vale *0* 

Usando esto podemos recuperar el nombre del día de la semana:

```python
# y para saber el nombre del día usamos calendar
>>> import calendar
>>> from datetime import date
>>> hoy = date.today()
>>> print(calendar.day_name[hoy.weekday()])
monday
```

Para obtener los nombres de los meses y días en el idioma local debemos establecer la localización con el módulo *locale*. Por ejemplo para establecer el "español" de "España" haríamos

```python
>>> import locale
>>> locale.setlocale(locale.LC_ALL,'es_ES.UTF-8')
'es_ES.UTF-8'
```
A partir de este momento este intérprete mostrará los resultados traducidos:

```python
>>> import calendar
>>> calendar.month_name[1:]
['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre']
>>> calendar.day_name[:]
['lunes', 'martes', 'miércoles', 'jueves', 'viernes', 'sábado', 'domingo']
```

### Imprimiendo calendarios con *calendar*

También podemos usar *calendar*, como su nombre indica, para mostar un calendario. Por ejemplo, el método *month(yy,mm)* devuelve una cadena con un calendario del mes mm del año yy:

```python
>>> import calendar
>>> print(calendar.month(2004,5))
     mayo 2004
lu ma mi ju vi sá do
                1  2
 3  4  5  6  7  8  9
10 11 12 13 14 15 16
17 18 19 20 21 22 23
24 25 26 27 28 29 30
31
```

También podemos mostar el año completo con *calendar(year)*:

```python
>>> import calendar
>>> print(calendar.calendar(2004))
                                  2004

       enero                    febrero                    marzo
lu ma mi ju vi sá do      lu ma mi ju vi sá do      lu ma mi ju vi sá do
          1  2  3  4                         1       1  2  3  4  5  6  7
 5  6  7  8  9 10 11       2  3  4  5  6  7  8       8  9 10 11 12 13 14
12 13 14 15 16 17 18       9 10 11 12 13 14 15      15 16 17 18 19 20 21
19 20 21 22 23 24 25      16 17 18 19 20 21 22      22 23 24 25 26 27 28
26 27 28 29 30 31         23 24 25 26 27 28 29      29 30 31

       abril                      mayo                     junio
lu ma mi ju vi sá do      lu ma mi ju vi sá do      lu ma mi ju vi sá do
          1  2  3  4                      1  2          1  2  3  4  5  6
 5  6  7  8  9 10 11       3  4  5  6  7  8  9       7  8  9 10 11 12 13
12 13 14 15 16 17 18      10 11 12 13 14 15 16      14 15 16 17 18 19 20
19 20 21 22 23 24 25      17 18 19 20 21 22 23      21 22 23 24 25 26 27
26 27 28 29 30            24 25 26 27 28 29 30      28 29 30
                          31

       julio                     agosto                  septiembre
lu ma mi ju vi sá do      lu ma mi ju vi sá do      lu ma mi ju vi sá do
          1  2  3  4                         1             1  2  3  4  5
 5  6  7  8  9 10 11       2  3  4  5  6  7  8       6  7  8  9 10 11 12
12 13 14 15 16 17 18       9 10 11 12 13 14 15      13 14 15 16 17 18 19
19 20 21 22 23 24 25      16 17 18 19 20 21 22      20 21 22 23 24 25 26
26 27 28 29 30 31         23 24 25 26 27 28 29      27 28 29 30
                          30 31

      octubre                  noviembre                 diciembre
lu ma mi ju vi sá do      lu ma mi ju vi sá do      lu ma mi ju vi sá do
             1  2  3       1  2  3  4  5  6  7             1  2  3  4  5
 4  5  6  7  8  9 10       8  9 10 11 12 13 14       6  7  8  9 10 11 12
11 12 13 14 15 16 17      15 16 17 18 19 20 21      13 14 15 16 17 18 19
18 19 20 21 22 23 24      22 23 24 25 26 27 28      20 21 22 23 24 25 26
25 26 27 28 29 30 31      29 30                     27 28 29 30 31

```


## Recuperando fechas de texto

A veces queremos recuperar una fecha de un texto, es decir, tenemos una cadena que sabemos que incluye información de fecha y de hora y queremos recuperar un datetime para poder utilizarlo de una forma más sencilla.

Para ello utilizaremos el método **parse** de la clase *datetime.parser* que nos permite recuperar tanto la fecha desde una cadena que sabemos que contiene una fecha, como desde un texto, por ejemplo una línea de un mensaje de error de un programa. A partir de ahí también podemos recuperar una fecha concreta.

Si tenemos seguridad de que la cadena incluye sólo una fecha lo usaremos así:

```python
>>> from dateutil.parser import parse
>>> fechaStr = '10-5-2021 18:45:12'
>>> parse(fechaStr)
datetime.datetime(2021, 10, 5, 18, 45, 12)
```

En el caso de la fecha esté incluída dentro de un texto podemos usar el parámetro *fuzzy=True* que buscará la parte de la fecha y nos la devolverá:

```python
>>> from dateutil.parser import parse
>>> log_line = 'INFO 2014-07-03T23:27:51 supybot Shutdown complete.'
>>> parse(log_line, fuzzy=True)
datetime.datetime(2014, 7, 3, 23, 27, 51)
```
